import { SearchBoxCore } from '@mapbox/search-js-core';
import { renderHook, act } from '@testing-library/react-hooks';

import { useSearchBoxCore } from '../../src/hooks/useSearchBoxCore';

const ACCESS_TOKEN = 'xyz';

describe('useSearchBoxCore', () => {
  it('works with access token', () => {
    const { result, rerender } = renderHook(
      ({ accessToken }) => useSearchBoxCore({ accessToken }),
      { initialProps: { accessToken: ACCESS_TOKEN } }
    );

    expect(result.current).toEqual(expect.any(SearchBoxCore));
    expect(result.current.accessToken).toEqual(ACCESS_TOKEN);

    act(() => {
      rerender({ accessToken: 'abc' });
    });

    expect(result.current.accessToken).toEqual('abc');
  });

  it('works with options', () => {
    const { result, rerender } = renderHook(
      ({ options }) =>
        useSearchBoxCore({ accessToken: ACCESS_TOKEN, ...options }),
      { initialProps: { options: {} } }
    );

    expect(result.current).toEqual(expect.any(SearchBoxCore));
    expect(result.current.defaults).toEqual(SearchBoxCore.defaults);

    act(() => {
      rerender({ options: { language: 'jp' } });
    });

    expect(result.current.defaults).toEqual({
      ...SearchBoxCore.defaults,
      language: 'jp'
    });

    // Make sure previous language is "undone".
    act(() => {
      rerender({ options: { proximity: [0, 0] } });
    });

    expect(result.current.defaults).toEqual({
      ...SearchBoxCore.defaults,
      language: 'en',
      proximity: [0, 0]
    });
  });
});
